---
// Heavy inspiration taken from Astro Starlight -> https://github.com/withastro/starlight/blob/main/packages/starlight/components/Search.astro

import '@pagefind/default-ui/css/ui.css'
---

<site-search class='ms-2 sm:ms-4' id='search'>
	<button
		data-open-modal
		disabled
		class='relative rounded-md border border-border p-1 transition-all hover:bg-border'
	>
		<svg
			xmlns='http://www.w3.org/2000/svg'
			aria-label='search'
			viewBox='0 0 24 24'
			stroke-width='1.5'
			class='h-6 w-6 fill-none stroke-current'
		>
			<path
				stroke-linecap='round'
				stroke-linejoin='round'
				d='m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z'></path>
		</svg>
	</button>
	<dialog
		aria-label='search'
		class='bg-bgColor h-full max-h-full w-full max-w-full border border-border shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md'
	>
		<div class='dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6'>
			<button
				class='ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700'
				data-close-modal>Close</button
			>
					<div class='search-container'>
						<div id='site_search'> </div>
					</div>
					</button>
		</div>
	</dialog>
</site-search>

<script>
	const { PagefindUI } = await import("@pagefind/default-ui");
	window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>

<style is:global>
	:root {
		--pagefind-ui-font: inherit;
	}

	#cactus__search .pagefind-ui__search-clear {
		width: calc(60px * var(--pagefind-ui-scale));
		padding: 0;
		background-color: transparent;
		overflow: hidden;
	}
	#cactus__search .pagefind-ui__search-clear:focus {
		outline: 1px solid theme('colors.accent.foreground');
	}
	#cactus__search .pagefind-ui__search-clear::before {
		content: '';
		-webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' %3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12'%3E%3C/path%3E%3C/svg%3E")
			center / 60% no-repeat;
		mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' %3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12'%3E%3C/path%3E%3C/svg%3E")
			center / 60% no-repeat;
		background-color: theme('colors.accent.DEFAULT');
		display: block;
		width: 100%;
		height: 100%;
	}

	#cactus__search .pagefind-ui__result {
		border: 0;
	}

	#cactus__search .pagefind-ui__result-link {
		background-size: 100% 6px;
		background-position: bottom;
		background-repeat: repeat-x;
		background-image: linear-gradient(
			transparent,
			transparent 5px,
			theme('colors.primary.DEFAULT') 5px,
			theme('colors.primary.DEFAULT')
		);
	}

	#cactus__search .pagefind-ui__result-link:hover {
		text-decoration: none;
		background-image: linear-gradient(
			transparent,
			transparent 4px,
			theme('colors.primary.foreground') 4px,
			theme('colors.primary.foreground')
		);
	}

	#cactus__search mark {
		color: theme('colors.muted.DEFAULT');
		background-color: transparent;
		font-weight: 600;
	}
</style>

<style>
	#cactus__search {
		--pagefind-ui-primary: theme('colors.accent.DEFAULT');
		--pagefind-ui-text: theme('colors.primary.DEFAULT');
		--pagefind-ui-background: theme('colors.background');
		--pagefind-ui-border: theme('colors.zinc.400');
		--pagefind-ui-border-width: 1px;
	}
</style>
