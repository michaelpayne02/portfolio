---
import { menuLinks } from '@/site-config'
import SearchBox from './SearchBox.astro'
import ThemeToggle from './ThemeToggle.astro'
import Logo from './Logo.astro'

const url = new URL(Astro.request.url)
---

<header
  class='mb-10 flex w-full flex-wrap items-center gap-y-3 pb-3 font-mono sm:flex-nowrap sm:justify-start'
>
  <Logo />

  <nav
    class='order-3 me-2 flex w-full flex-row gap-x-5 font-medium sm:order-2 sm:w-auto sm:gap-x-4'
  >
    {
      menuLinks.map((link) => (
        <a
          aria-current={url.pathname === link.path ? 'page' : false}
          href={link.path}
          data-astro-prefetch
          class='flex-none hover:text-foreground/75 sm:text-[1.05rem]'
          aria-label={link.path + ' nav item'}
        >
          {link.title}
        </a>
      ))
    }
  </nav>
  <div
    class='relative order-2 ms-0 flex h-8 flex-row gap-x-2 sm:order-3 sm:ms-2 sm:gap-x-4'
  >
    <SearchBox />
    <ThemeToggle />
  </div>
</header>
<script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme')
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  const root = document.documentElement
  if (theme === 'light') {
    root.classList.remove('dark')
  } else {
    root.classList.add('dark')
  }
</script>
